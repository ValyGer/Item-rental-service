DROP TABLE IF EXISTS "USERS" CASCADE;
DROP TABLE IF EXISTS "ITEMS" CASCADE;
DROP TABLE IF EXISTS "REQUESTS" CASCADE;
DROP TABLE IF EXISTS "BOOKINGS" CASCADE;
DROP TABLE IF EXISTS "COMMENTS" CASCADE;

CREATE TABLE "USERS" (
  "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  "NAME" VARCHAR(255) NOT NULL,
  "EMAIL" VARCHAR(512) NOT NULL,
  PRIMARY KEY ("ID")
);

CREATE TABLE "REQUESTS" (
  "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  "DESCRIPTION" VARCHAR(2048) NOT NULL,
  "REQUESTER_ID" BIGINT NOT NULL,
  "CREATED" TIMESTAMP NOT NULL,
  PRIMARY KEY ("ID")
);

CREATE TABLE "ITEMS" (
  "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  "NAME" VARCHAR(255) NOT NULL,
  "DESCRIPTION" VARCHAR(2048) NOT NULL,
  "OWNER_ID" BIGINT NOT NULL,
  "STATUS" BOOLEAN,
  "REQUEST_ID" BIGINT,
  PRIMARY KEY ("ID")
);

CREATE TABLE "BOOKINGS" (
  "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  "START_DATE_TIME" TIMESTAMP NOT NULL,
  "END_DATE_TIME" TIMESTAMP NOT NULL,
  "ITEM_ID" BIGINT,
  "BOOKER_ID" BIGINT,
  "STATUS" varchar(50),
  PRIMARY KEY ("ID")
);

CREATE TABLE "COMMENTS" (
  "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  "TEXT" VARCHAR(2048) NOT NULL,
  "ITEM_ID" BIGINT,
  "AUTHOR_ID" BIGINT,
  "CREATED" TIMESTAMP NOT NULL,
  PRIMARY KEY ("ID")
);

CREATE UNIQUE INDEX "uq_user_email" ON "USERS" ("EMAIL");

ALTER TABLE "REQUESTS" ADD CONSTRAINT "fk_request_users" FOREIGN KEY ("REQUESTER_ID") REFERENCES "USERS" ("ID") ON DELETE CASCADE;

ALTER TABLE "ITEMS" ADD CONSTRAINT "fk_item_users" FOREIGN KEY ("OWNER_ID") REFERENCES "USERS" ("ID") ON DELETE CASCADE;

ALTER TABLE "ITEMS" ADD CONSTRAINT "fk_item_requests" FOREIGN KEY ("REQUEST_ID") REFERENCES "REQUESTS" ("ID") ON DELETE CASCADE;

ALTER TABLE "BOOKINGS" ADD CONSTRAINT "fk_booking_users" FOREIGN KEY ("BOOKER_ID") REFERENCES "USERS" ("ID") ON DELETE CASCADE;

ALTER TABLE "BOOKINGS" ADD CONSTRAINT "fk_booking_item" FOREIGN KEY ("ITEM_ID") REFERENCES "ITEMS" ("ID") ON DELETE CASCADE;

ALTER TABLE "COMMENTS" ADD CONSTRAINT "fk_comment_users" FOREIGN KEY ("AUTHOR_ID") REFERENCES "USERS" ("ID") ON DELETE CASCADE;

ALTER TABLE "COMMENTS" ADD CONSTRAINT "fk_comment_items" FOREIGN KEY ("ITEM_ID") REFERENCES "ITEMS" ("ID") ON DELETE CASCADE;
